import matplotlib.pyplot as plt
import pandas as pd

# 数据解析
data = {
    'Epoch': list(range(1, 101)),
    # Loss (Train)
    'Train_Seg_Loss': [1.3915, 1.0682, 0.8489, 0.7345, 0.6726, 0.6344, 0.6040, 0.5799, 0.5623, 0.5537,
                       0.5325, 0.5139, 0.5049, 0.4942, 0.4856, 0.4796, 0.4686, 0.4632, 0.4542, 0.4462,
                       0.4469, 0.4319, 0.4327, 0.4321, 0.4239, 0.4224, 0.4191, 0.4124, 0.4055, 0.4037,
                       0.3999, 0.3968, 0.3973, 0.3923, 0.3874, 0.3878, 0.3807, 0.3607, 0.3396, 0.3363,
                       0.3216, 0.3191, 0.3145, 0.3097, 0.3030, 0.2988, 0.2933, 0.2933, 0.2881, 0.2865,
                       0.2860, 0.2811, 0.2825, 0.2783, 0.2756, 0.2756, 0.2695, 0.2691, 0.2660, 0.2660,
                       0.2671, 0.2646, 0.2621, 0.2606, 0.2585, 0.2570, 0.2563, 0.2566, 0.2544, 0.2522,
                       0.2522, 0.2493, 0.2462, 0.2324, 0.2220, 0.2184, 0.2117, 0.2083, 0.2058, 0.2013,
                       0.2011, 0.1982, 0.1954, 0.1927, 0.1896, 0.1907, 0.1903, 0.1945, 0.1917, 0.1849,
                       0.1849, 0.1870, 0.1856, 0.1855, 0.1856, 0.1852, 0.1897, 0.1860, 0.1864, 0.1838],
    # mIoU (Train)
    'Train_mIoU': [7.40, 14.65, 22.64, 27.72, 30.82, 35.06, 37.08, 39.67, 41.25, 42.92,
                   45.02, 46.02, 47.61, 48.98, 49.78, 50.32, 52.41, 51.31, 53.96, 55.42,
                   55.37, 56.96, 57.12, 56.74, 59.01, 57.81, 58.48, 58.77, 60.04, 61.21,
                   61.46, 62.28, 61.72, 62.33, 63.21, 63.20, 63.80, 62.82, 63.46, 63.32,
                   64.46, 63.41, 63.05, 63.60, 65.54, 66.01, 64.63, 66.16, 67.05, 67.27,
                   66.99, 67.60, 66.98, 68.33, 68.58, 68.28, 68.75, 69.41, 69.09, 69.70,
                   69.86, 69.76, 70.48, 70.62, 70.52, 70.64, 70.54, 71.05, 71.62, 71.77,
                   71.90, 71.57, 72.38, 71.58, 72.49, 71.83, 72.07, 72.09, 71.98, 72.67,
                   72.12, 72.96, 72.45, 72.61, 73.04, 73.25, 73.25, 72.62, 72.68, 73.16,
                   73.22, 73.07, 73.10, 73.53, 73.44, 73.49, 73.35, 73.46, 73.51, 73.39],
    # mIoU (Val)
    'Val_mIoU': [9.63, 20.18, 22.91, 27.46, 35.19, 36.61, 43.35, 40.46, 45.55, 46.45,
                 46.88, 48.43, 48.50, 48.21, 52.08, 52.85, 52.08, 52.13, 52.97, 54.17,
                 51.88, 55.34, 53.82, 54.05, 57.09, 57.00, 55.93, 57.32, 56.93, 56.83,
                 56.54, 57.51, 56.53, 55.77, 59.56, 59.52, 57.64, 56.08, 57.88, 59.05,
                 53.89, 58.01, 58.60, 59.79, 60.64, 59.82, 60.21, 56.86, 60.04, 61.59,
                 60.13, 61.65, 60.81, 61.27, 61.04, 61.65, 61.57, 61.18, 61.47, 62.76,
                 62.83, 61.28, 62.18, 61.30, 62.17, 63.73, 65.20, 63.31, 62.47, 63.28,
                 64.40, 63.72, 63.71, 61.97, 63.00, 63.17, 63.07, 63.27, 64.05, 63.67,
                 63.37, 63.52, 63.92, 63.70, 63.78, 63.42, 63.89, 63.80, 64.41, 64.06,
                 63.78, 63.79, 64.31, 64.21, 64.07, 64.06, 64.33, 64.07, 63.96, 64.13]
}

df = pd.DataFrame(data)

# 绘图
plt.figure(figsize=(15, 6))

# 1. Seg Loss 曲线
plt.subplot(1, 2, 1)
plt.plot(df['Epoch'], df['Train_Seg_Loss'], label='Train Seg Loss', color='red', linewidth=2)
plt.title('Training Segmentation Loss', fontsize=14)
plt.xlabel('Epoch')
plt.ylabel('Loss')
plt.grid(True, linestyle='--', alpha=0.6)
plt.legend()

# 2. mIoU 对比曲线
plt.subplot(1, 2, 2)
plt.plot(df['Epoch'], df['Train_mIoU'], label='Train mIoU', color='blue', linestyle='--', alpha=0.7)
plt.plot(df['Epoch'], df['Val_mIoU'], label='Val mIoU', color='green', linewidth=2)

# --- 修正的部分 START ---
# 找到 Val_mIoU 最大值所在的行索引
best_idx = df['Val_mIoU'].idxmax()
max_val_miou = df.loc[best_idx, 'Val_mIoU']
max_epoch = df.loc[best_idx, 'Epoch']
# --- 修正的部分 END ---

plt.scatter(max_epoch, max_val_miou, color='red', s=50, zorder=5)
plt.text(max_epoch, max_val_miou - 5, f'Best: {max_val_miou:.2f}%\n(Epoch {max_epoch})',
         fontsize=10, color='red', ha='center', fontweight='bold')

plt.title('mIoU Curve (Train vs Val)', fontsize=14)
plt.xlabel('Epoch')
plt.ylabel('mIoU (%)')
plt.grid(True, linestyle='--', alpha=0.6)
plt.legend()

plt.tight_layout()
plt.show()